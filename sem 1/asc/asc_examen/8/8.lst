     1                                  bits 32
     2                                  global start
     3                                  
     4                                  extern exit, fopen, fclose, fprintf, scanf
     5                                  import exit msvcrt.dll
     6                                  import fopen msvcrt.dll
     7                                  import fclose msvcrt.dll
     8                                  import fprintf msvcrt.dll
     9                                  import scanf msvcrt.dll
    10                                  
    11                                  
    12                                  segment data use32 class = data
    13 00000000 737472696E672E7478-         file_name db "string.txt", 0
    13 00000009 7400               
    14 0000000B 772B00                      file_mode db "w+", 0
    15 0000000E FFFFFFFF                    file_descr dd -1
    16 00000012 257300                      file_w_format db "%s", 0
    17                                      
    18 00000015 257300                      r_format db "%s", 0
    19                                      
    20 00000018 0000<rept>                  cuv times 100 db 0, 0
    21 000000E0 0000<rept>                  ans times 100 db 0, 0
    22 000001A8 00000000                    cuv_len dd 0
    23                                      
    24                                      
    25                                  segment code use32 class = code
    26                                      start:
    27 00000000 68[18000000]                    push dword cuv
    28 00000005 68[15000000]                    push dword r_format
    29 0000000A FF15[00000000]                  call [scanf]
    30 00000010 83C408                          add esp, 4 * 2
    31                                          
    32 00000013 BE00000000                      mov esi, 0
    33                                          
    34                                          rep_1:
    35 00000018 8A86[18000000]                      mov al, [cuv + esi]
    36 0000001E 3C00                                cmp al, 0
    37 00000020 7403                                je exit_rep_1
    38                                              
    39 00000022 46                                  inc esi
    40                                          
    41 00000023 EBF3                                jmp rep_1
    42                                              
    43                                          exit_rep_1:
    44 00000025 4E                              dec esi
    45 00000026 8935[A8010000]                  mov [cuv_len], esi
    46 0000002C BE00000000                      mov esi, 0
    47 00000031 BF00000000                      mov edi, 0
    48                                          
    49                                          rep_2:
    50 00000036 8A86[18000000]                      mov al, [cuv + esi]
    51 0000003C 3C00                                cmp al, 0
    52 0000003E 7412                                je exit_rep_2
    53                                              
    54 00000040 3C41                                cmp al, 'A'
    55 00000042 720B                                jb not_maj
    56                                              
    57 00000044 3C5A                                cmp al, 'Z'
    58 00000046 7707                                ja not_maj
    59                                              
    60 00000048 8887[E0000000]                      mov [ans + edi], al
    61 0000004E 47                                  inc edi
    62                                          
    63                                              not_maj:
    64 0000004F 46                                  inc esi
    65                                              
    66 00000050 EBE4                                jmp rep_2
    67                                          
    68                                          exit_rep_2:
    69 00000052 8B35[A8010000]                  mov esi, [cuv_len]
    70                                          
    71                                          rep_3:
    72 00000058 83FEFF                              cmp esi, -1
    73 0000005B 7418                                je exit_rep_3 
    74                                              
    75 0000005D 8A86[18000000]                      mov al, [cuv + esi]
    76 00000063 3C61                                cmp al, 'a'
    77 00000065 720B                                jb not_min
    78                                          
    79 00000067 3C7A                                cmp al, 'z'
    80 00000069 7707                                ja not_min
    81                                              
    82 0000006B 8887[E0000000]                      mov [ans + edi], al
    83 00000071 47                                  inc edi
    84                                          
    85                                              not_min:
    86 00000072 4E                                  dec esi
    87                                              
    88 00000073 EBE3                                jmp rep_3
    89                                              
    90                                          exit_rep_3:
    91 00000075 68[0B000000]                    push dword file_mode
    92 0000007A 68[00000000]                    push dword file_name
    93 0000007F FF15[00000000]                  call [fopen]
    94 00000085 83C408                          add esp, 4 * 2
    95                                          
    96 00000088 A3[0E000000]                    mov [file_descr], eax
    97 0000008D 83F800                          cmp eax, 0
    98 00000090 7428                            je final
    99                                          
   100 00000092 68[E0000000]                    push dword ans
   101 00000097 68[12000000]                    push dword file_w_format
   102 0000009C FF35[0E000000]                  push dword [file_descr]
   103 000000A2 FF15[00000000]                  call [fprintf]
   104 000000A8 83C40C                          add esp, 4 * 3
   105                                          
   106 000000AB FF35[0E000000]                  push dword [file_descr]
   107 000000B1 FF15[00000000]                  call [fclose]
   108 000000B7 83C404                          add esp, 4 * 1
   109                                          
   110                                          final:
   111 000000BA 6A00                            push dword 0
   112 000000BC FF15[00000000]                  call [exit]
